# ZAB

## 简介
ZAB是ZK在paxos基础上设计的，正对分布式系统一致性的一个协议，他主要保证了CAP理论中的CP。他的竞争对手Eureka则是AP架构的，作为服务注册与发现而言，Eureka更合适。。

## 协议内容
在一个ZK集群中，存在一个leader服务器，它用来处理所有的事务请求。。其他服务则为follower服务器。。leader服务器负责将一个客户端事务请求转化为一个事务提议（Proposal），并将该事务提议分发给集群中所有的Follower服务器。然后leader服务器等待follower服务器的反馈，如果超过半数的follower接受了该提议，那么leader就认为该事务提议有效。。并且再次向所有的follower服务器发送commit消息，要求将该提议进行提交。

## 崩溃恢复
zk集群在重启，leader服务器出现网络中断，崩溃，超过半数的服务器与leader不能正常通信等异常情况下，就会进入恢复模式，重新选举leader服务器。leader选举好之后，就进入正常运行的消息广播模式。
### leader选举算法
略略略（还没搞懂）
### 脑裂
在高可用（HA）系统中，当联系2个节点的“心跳线”断开时，本来为一整体、动作协调的HA系统，就分裂成为2个独立的个体。由于相互失去了联系，都以为是对方出了故障。两个节点上的HA软件像“裂脑人”一样，争抢“共享资源”、争起“应用服务”，就会发生严重后果——或者共享资源被瓜分、2边“服务”都起不来了；或者2边“服务”都起来了，但同时读写“共享存储”，导致数据损坏（常见如数据库轮询着的联机日志出错）。
## 消息广播
略略略
